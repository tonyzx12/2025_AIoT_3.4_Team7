ç¬¬ä¸€æ­¥ï¼Œé¸å®šdataset
æˆ‘å€‘é¸æ“‡ä»¥æ°´æœä½œç‚ºç›®æ¨™
https://universe.roboflow.com/object-detection-fruit/fruit-smrhb
![image](https://hackmd.io/_uploads/ByWvn1FEbl.png)

ç¬¬äºŒæ­¥
å°‡datasetä»¥zipä¸Šå‚³åˆ°s3ä¸­çš„æŒ‡å®šä½ç½®
![image](https://hackmd.io/_uploads/HyGihytN-e.png)
![image](https://hackmd.io/_uploads/ByrkaJYNWl.png)



ç¬¬ä¸‰æ­¥
ä¿®æ”¹ç¯„ä¾‹è¨“ç·´ç”¨è…³æœ¬
(1)åƒæ•¸è¨­å®š
```
# ====== ä½ è¦æ”¹çš„åœ°æ–¹ ======
S3_DATA_ZIP = 's3://2025team7/Fruit.v7i.yolov11.zip'  # <<<<<< æ”¹æˆä½ çš„è³‡æ–™é›†
DATA_ZIP_FILENAME = 'Fruit.v7i.yolov11.zip'                     # zip æª”å

# é¡åˆ¥åç¨±ï¼ˆè«‹æ”¹æˆä½ çš„ classesï¼‰
CLASS_NAMES = ['apple', 'banana', 'grape', 'kiwi', 'lemon', 'orange', 'peach', 'pineapple', 'strawberry', 'watermelon']

# YOLO11 æ¬Šé‡ï¼ˆå¯æ”¹ yolo11s.pt / yolo11m.pt / yolo11l.pt / yolo11x.ptï¼‰
YOLO_MODEL = 'yolo11n.pt'

# è¨“ç·´è¶…åƒæ•¸
EPOCHS = 50
IMGSZ = 640
BATCH = 16
WORKERS = 4

# è¨“ç·´ç¡¬é«”ï¼ˆæ¨è–¦ GPUï¼šg5 / g4dnï¼‰
INSTANCE_TYPE = 'ml.g5.2xlarge'
INSTANCE_COUNT = 1

# è¼¸å‡ºåˆ° S3
OUTPUT_S3 = f"s3://2025team7/yolo11/output/"

print('S3_DATA_ZIP:', S3_DATA_ZIP)
print('OUTPUT_S3:', OUTPUT_S3)

print('Classes:', len(CLASS_NAMES), 'å€‹æ°´æœé¡åˆ¥')

```
![image](https://hackmd.io/_uploads/ryZ83eFVWg.png)

(2) ç”Ÿæˆè¨“ç·´ç¨‹å¼ç¢¼ï¼ˆtrain.pyï¼‰èˆ‡ requirements.txt

```
src_dir = Path('src')
src_dir.mkdir(exist_ok=True)

train_py = r'''
import argparse
import base64
import json
import zipfile
import shutil
from pathlib import Path
import yaml
from ultralytics import YOLO

def main():
    p = argparse.ArgumentParser()
    p.add_argument('--data_zip', type=str, default='mydata.zip')
    p.add_argument('--model', type=str, default='yolo11n.pt')
    p.add_argument('--epochs', type=int, default=50)
    p.add_argument('--imgsz', type=int, default=640)
    p.add_argument('--batch', type=int, default=16)
    p.add_argument('--workers', type=int, default=4)

    # âœ… æ”¹æˆ base64ï¼Œé¿å… argv è¢«æ‹†
    p.add_argument('--class_names_b64', type=str, required=True)

    args = p.parse_args()

    # âœ… è§£ç¢¼å› list[str]
    class_names = json.loads(base64.b64decode(args.class_names_b64).decode("utf-8"))

    sm_data_dir = Path('/opt/ml/input/data/training')
    sm_model_dir = Path('/opt/ml/model')
    sm_model_dir.mkdir(parents=True, exist_ok=True)

    work_dir = Path('/tmp/data')
    work_dir.mkdir(parents=True, exist_ok=True)

    # âœ… è§£å£“ zip æª”æ¡ˆ
    zip_path = sm_data_dir / args.data_zip
    print(f"ğŸ“¦ Extracting {zip_path} to {work_dir}")
    with zipfile.ZipFile(zip_path, 'r') as z:
        z.extractall(work_dir)

    # âœ… å°‹æ‰¾ Fruit.v7i.yolov11 è³‡æ–™å¤¾ï¼ˆæˆ–ä»»ä½•åŒ…å« train/valid çš„è³‡æ–™å¤¾ï¼‰
    dataset_root = None
    for item in work_dir.rglob('*'):
        if item.is_dir():
            # æª¢æŸ¥æ˜¯å¦åŒ…å« train å’Œ valid å­è³‡æ–™å¤¾
            if (item / 'train').exists() and (item / 'valid').exists():
                dataset_root = item
                break

    # å¦‚æœæ‰¾ä¸åˆ°ï¼Œå˜—è©¦ç›´æ¥ä½¿ç”¨ work_dir
    if dataset_root is None:
        if (work_dir / 'train').exists() and (work_dir / 'valid').exists():
            dataset_root = work_dir
        else:
            # åˆ—å‡ºæ‰€æœ‰å…§å®¹ä»¥ä¾¿é™¤éŒ¯
            print("âŒ Cannot find train/valid folders. Contents of work_dir:")
            for item in work_dir.rglob('*'):
                print(f"  {item}")
            raise FileNotFoundError("Cannot find dataset with train/valid folders")

    print(f"âœ… Found dataset root: {dataset_root}")
    print(f"   Train folder: {dataset_root / 'train'}")
    print(f"   Valid folder: {dataset_root / 'valid'}")

    data_yaml = {
        'path': str(dataset_root),
        'train': 'train/images',  # ä½¿ç”¨ç›¸å°è·¯å¾‘
        'val': 'valid/images',    # ä½¿ç”¨ç›¸å°è·¯å¾‘
        'test': 'test/images',    # ä½¿ç”¨ç›¸å°è·¯å¾‘
        'names': class_names,
        'nc': len(class_names),
    }
    yaml_path = work_dir / 'data.yaml'
    with open(yaml_path, 'w') as f:
        yaml.safe_dump(data_yaml, f)

    print(f"âœ… Created data.yaml with {len(class_names)} classes")
    print(f"   Path: {data_yaml['path']}")
    print(f"   Train: {data_yaml['train']}")
    print(f"   Val:   {data_yaml['val']}")

    model = YOLO(args.model)
    project_dir = sm_model_dir / 'runs'
    model.train(
        data=str(yaml_path),
        epochs=args.epochs,
        imgsz=args.imgsz,
        batch=args.batch,
        workers=args.workers,
        project=str(project_dir),
        name='train',
        verbose=True,
        patience=50,  # Early stopping patience
        save=True,
        plots=True,
    )

    best_pt = project_dir / 'train' / 'weights' / 'best.pt'
    if best_pt.exists():
        shutil.copy2(best_pt, sm_model_dir / 'best.pt')
        print("âœ… Copied best.pt to model dir")

if __name__ == '__main__':
    main()

'''

(src_dir / 'train.py').write_text(train_py, encoding='utf-8')
(src_dir / 'requirements.txt').write_text('ultralytics\nopencv-python\npyyaml\n', encoding='utf-8')
print('Wrote:', src_dir / 'train.py')
print('Wrote:', src_dir / 'requirements.txt')

```
![image](https://hackmd.io/_uploads/rJaNnlK4Zl.png)

(3) å»ºç«‹ Estimator ä¸¦å•Ÿå‹• Training Jobï¼ˆéé˜»å¡ï¼‰
![image](https://hackmd.io/_uploads/SJ0whxtEbe.png)

(4) å‹•æ…‹é¡¯ç¤ºè¨“ç·´éç¨‹èˆ‡æ”¶æ–‚æ›²ç·šï¼ˆå³æ™‚ï¼‰
![image](https://hackmd.io/_uploads/ryW22ltE-x.png)

```
TrainingJob: yolo11-train-1767602003
Status     : Completed
Region     : us-east-1
----- logs tail -----
#033[K      50/50      2.61G     0.5524     0.3848     0.9958         21        640: 96% â”â”â”â”â”â”â”â”â”â”â”â•¸ 93/97 11.5it/s 8.5s<0.3s
#033[K      50/50      2.61G     0.5528     0.3849     0.9955         48        640: 98% â”â”â”â”â”â”â”â”â”â”â”â•¸ 95/97 11.0it/s 8.7s<0.2s
#033[K      50/50      2.61G     0.5561     0.3846     0.9979         28        640: 100% â”â”â”â”â”â”â”â”â”â”â”â” 97/97 11.0it/s 8.8s#015#033[K      50/50      2.61G     0.5561     0.3846     0.9979         28        640: 100% â”â”â”â”â”â”â”â”â”â”â”â” 97/97 11.0it/s 8.8s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 7% â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1/14 2.9it/s 0.1s<4.5s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 14% â”â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2/14 5.0it/s 0.2s<2.4s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 21% â”â”â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3/14 6.2it/s 0.3s<1.8s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 29% â”â”â”â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4/14 7.1it/s 0.4s<1.4s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 36% â”â”â”â”â”€â”€â”€â”€â”€â”€â”€â”€ 5/14 7.5it/s 0.5s<1.2s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 43% â”â”â”â”â”â”€â”€â”€â”€â”€â”€â”€ 6/14 8.0it/s 0.6s<1.0s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 50% â”â”â”â”â”â”â”€â”€â”€â”€â”€â”€ 7/14 8.5it/s 0.8s<0.8s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 57% â”â”â”â”â”â”â•¸â”€â”€â”€â”€â”€ 8/14 8.9it/s 0.9s<0.7s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 64% â”â”â”â”â”â”â”â•¸â”€â”€â”€â”€ 9/14 9.1it/s 1.0s<0.6s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 71% â”â”â”â”â”â”â”â”â•¸â”€â”€â”€ 10/14 9.1it/s 1.1s<0.4s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 79% â”â”â”â”â”â”â”â”â”â”€â”€â”€ 11/14 9.2it/s 1.2s<0.3s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 93% â”â”â”â”â”â”â”â”â”â”â”â”€ 13/14 9.5it/s 1.4s<0.1s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100% â”â”â”â”â”â”â”â”â”â”â”â” 14/14 9.8it/s 1.4s#015#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100% â”â”â”â”â”â”â”â”â”â”â”â” 14/14 9.8it/s 1.4s
all        430        880      0.913      0.855      0.892      0.737
50 epochs completed in 0.150 hours.
Optimizer stripped from /opt/ml/model/runs/train/weights/last.pt, 5.5MB
Optimizer stripped from /opt/ml/model/runs/train/weights/best.pt, 5.5MB
Validating /opt/ml/model/runs/train/weights/best.pt...
Ultralytics 8.3.248 ğŸš€ Python-3.10.13 torch-2.2.0 CUDA:0 (NVIDIA A10G, 22836MiB)
YOLO11n summary (fused): 100 layers, 2,584,102 parameters, 0 gradients, 6.3 GFLOPs
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 7% â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1/14 2.8it/s 0.1s<4.6s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 14% â”â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2/14 3.7it/s 0.3s<3.3s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 21% â”â”â•¸â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3/14 3.4it/s 0.6s<3.2s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 29% â”â”â”â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4/14 4.4it/s 0.8s<2.3s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 36% â”â”â”â”â”€â”€â”€â”€â”€â”€â”€â”€ 5/14 4.4it/s 1.0s<2.0s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 43% â”â”â”â”â”â”€â”€â”€â”€â”€â”€â”€ 6/14 5.8it/s 1.1s<1.4s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 50% â”â”â”â”â”â”â”€â”€â”€â”€â”€â”€ 7/14 6.6it/s 1.2s<1.1s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 57% â”â”â”â”â”â”â•¸â”€â”€â”€â”€â”€ 8/14 7.5it/s 1.3s<0.8s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 64% â”â”â”â”â”â”â”â•¸â”€â”€â”€â”€ 9/14 8.0it/s 1.5s<0.6s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 71% â”â”â”â”â”â”â”â”â•¸â”€â”€â”€ 10/14 8.0it/s 1.6s<0.5s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 79% â”â”â”â”â”â”â”â”â”â”€â”€â”€ 11/14 8.4it/s 1.7s<0.4s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 86% â”â”â”â”â”â”â”â”â”â”â”€â”€ 12/14 8.7it/s 1.8s<0.2s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 93% â”â”â”â”â”â”â”â”â”â”â”â”€ 13/14 9.0it/s 1.9s<0.1s
#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100% â”â”â”â”â”â”â”â”â”â”â”â” 14/14 7.2it/s 1.9s#015#033[K                 Class     Images  Instances      Box(P          R      mAP50  mAP50-95): 100% â”â”â”â”â”â”â”â”â”â”â”â” 14/14 7.2it/s 1.9s
all        430        880      0.891      0.871      0.918      0.744
apple         40         54      0.973      0.664       0.86      0.625
banana         43         45       0.95          1      0.995      0.964
                 grape         44         79      0.764      0.722      0.772      0.446
                  kiwi         45        133      0.852      0.819      0.904      0.735
lemon         43         43       0.99          1      0.995      0.938
                orange         43         90      0.684      0.878      0.918      0.738
peach         44         44      0.988          1      0.995      0.826
             pineapple         43         59      0.855      0.896      0.923      0.732
strawberry         40        177      0.966      0.989      0.989      0.834
watermelon         45        156      0.885      0.742      0.831      0.607
Speed: 0.1ms preprocess, 0.9ms inference, 0.0ms loss, 1.1ms postprocess per image
Results saved to #033[1m/opt/ml/model/runs/train#033[0m
âœ… Copied best.pt to model dir
2026-01-05 08:47:33,208 sagemaker-training-toolkit INFO     Waiting for the process to finish and give a return code.
2026-01-05 08:47:33,209 sagemaker-training-toolkit INFO     Done waiting for a return code. Received 0 from exiting process.
2026-01-05 08:47:33,209 sagemaker-training-toolkit INFO     Reporting training SUCCESS

Training job finished with status: Completed
```

(5) ä¸‹è¼‰ artifacts ä¸¦ç•«å‡ºå®Œæ•´æ”¶æ–‚æ›²ç·šï¼ˆresults.csv / results.pngï¼‰
```
Final status: Completed
Model artifact: s3://2025team7/yolo11/output/yolo11-train-1767602003/output/model.tar.gz
Downloaded: artifacts/yolo11-train-1767602003/model.tar.gz
best.pt exists: True
results.png exists: True
results.csv exists: True
```
![image](https://hackmd.io/_uploads/BkMLTlKVbx.png)
| epoch | time | train/box_loss | train/cls_loss | train/dfl_loss | metrics/precision(B) | metrics/recall(B) | metrics/mAP50(B) | metrics/mAP50-95(B) | val/box_loss | val/cls_loss | val/dfl_loss | lr/pg0 | lr/pg1 | lr/pg2 |
|------:|-----:|---------------:|---------------:|---------------:|---------------------:|------------------:|-----------------:|--------------------:|-------------:|-------------:|-------------:|-------:|-------:|-------:|
| 0 | 1 | 14.6288 | 1.02908 | 3.40605 | 1.35413 | 0.79277 | 0.38921 | 0.54117 | 0.41057 | 0.98152 | 2.70461 | 1.36771 | 0.000236 | 0.000236 |
| 1 | 2 | 25.9125 | 1.06901 | 2.04718 | 1.35154 | 0.68952 | 0.68715 | 0.72520 | 0.50086 | 1.10606 | 1.75986 | 1.47899 | 0.000464 | 0.000464 |
| 2 | 3 | 36.9779 | 1.04163 | 1.69427 | 1.32595 | 0.60377 | 0.61737 | 0.64304 | 0.44096 | 1.08869 | 2.02304 | 1.45333 | 0.000683 | 0.000683 |
| 3 | 4 | 47.8723 | 1.01654 | 1.53077 | 1.30303 | 0.75992 | 0.71055 | 0.76896 | 0.55094 | 1.05471 | 1.58653 | 1.41477 | 0.000672 | 0.000672 |
| 4 | 5 | 58.7861 | 1.01848 | 1.37161 | 1.28437 | 0.80406 | 0.77074 | 0.81516 | 0.59205 | 0.99810 | 1.29891 | 1.34609 | 0.000657 | 0.000657 |

![image](https://hackmd.io/_uploads/BkdKTlF4Ze.png)

(6) è¦–è¦ºåŒ–æ¨è«–ï¼ˆVisualized Inferenceï¼‰

```
Dataset extracted to: dataset_local

ğŸ” Searching for valid/images folder...
âœ… Found: dataset_local/valid/images
âœ… æ‰¾åˆ° 430 å¼µ validation å½±åƒ

ğŸ¯ Using weights: artifacts/yolo11-train-1767602003/best.pt
ğŸ“¸ Visualizing 8 fruit images:
   - good_quality_753_jpg.rf.1aa3ad514ff5f078b86a9a0e6fe34256.jpg
   - banana5_018_jpg.rf.e44f99c648369c18a58d6849477354b6.jpg
   - watermalon165_jpg.rf.04d1d3d3bf742566d06343f6f597eec7.jpg
   - IMG_1063_jpeg_jpeg.rf.43853e3b00e65aa6e3a9fc4f569d1eaa.jpg
   - fresh-336-_png.rf.d0403f4faf311cd4a1683607ed688b1b.jpg
   - 10ffbbdd_jpg.rf.d7836e74d6bae2789eca98df8e0f6012.jpg
   - good_quality_961_jpg.rf.f2601d534cefd7675e05f2c0a5a790c0.jpg
   - 6_jpg.rf.70ed83cdb8f7fd61b73736badb238fe6.jpg

ğŸ–¼ï¸  Layout: 2x4 grid

ğŸ“¸ good_quality_753_jpg.rf.1aa3ad514ff5f078b86a9a0e6fe34256.jpg
   ğŸ lemon: 93.25%

ğŸ“¸ banana5_018_jpg.rf.e44f99c648369c18a58d6849477354b6.jpg
   ğŸ banana: 96.51%

ğŸ“¸ watermalon165_jpg.rf.04d1d3d3bf742566d06343f6f597eec7.jpg
   ğŸ watermelon: 41.44%
   ğŸ watermelon: 40.74%

ğŸ“¸ IMG_1063_jpeg_jpeg.rf.43853e3b00e65aa6e3a9fc4f569d1eaa.jpg
   ğŸ kiwi: 97.01%

ğŸ“¸ fresh-336-_png.rf.d0403f4faf311cd4a1683607ed688b1b.jpg
   ğŸ orange: 92.78%

ğŸ“¸ 10ffbbdd_jpg.rf.d7836e74d6bae2789eca98df8e0f6012.jpg
   ğŸ strawberry: 90.44%

ğŸ“¸ good_quality_961_jpg.rf.f2601d534cefd7675e05f2c0a5a790c0.jpg
   ğŸ lemon: 94.04%

ğŸ“¸ 6_jpg.rf.70ed83cdb8f7fd61b73736badb238fe6.jpg
   ğŸ orange: 92.32%
   ğŸ orange: 92.22%
   ğŸ orange: 92.18%
   ğŸ orange: 87.14%
   ğŸ orange: 39.67%
   ğŸ orange: 29.22%
```

![æœªå‘½å](https://hackmd.io/_uploads/rk5UG-Y4Wx.jpg)



